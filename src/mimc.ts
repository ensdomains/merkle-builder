const FIELD =
	0x12ab655e9a2ca55660b44d1e5c37b00159aa76fed00000010a11800000000001n;

const ROUND_CONSTANTS: bigint[] = [
	0x0efda9332fcec268a3bbd0567797ce650be481c79da27f58b1a51ada4a91b014n,
	0x05253862ca9b15c2bd33e1a2b830659b7ae3657aacfa8986eec35d8ec2dd3446n,
	0x0db5be05400d438b9facd4a269a49031e8c7f947887a7c8653aae1675075f08dn,
	0x07850deb84c4b38c891c03f7acc0f0e0602877a2ae969dcd0b10d7facf26dddbn,
	0x01c2e148c40ea201b748bee72845b349bfa4a4497837af0d569ae47afc6e4243n,
	0x005a472abfb0d5d4b09a0da6d9d4c7ab93bf68299dc5222dc6ef81407825dba9n,
	0x03b0d15d7b62c8b4cfbce18816baeabb2e3df2d9a731d9d248d2f0498bdec1e4n,
	0x04e8da009db8982a082983402626f1f68655a4a3c83be89c165ba656be14d726n,
	0x02dcc7fbe0034e4fd51853c69fa7161a043c6757df0b3022fd8628c221b04c01n,
	0x0ef15ea4cf191c23a6eba0d9f4c6c978a7bb172b196d13438c30c1ce50aeefecn,
	0x0ddda0ea4d7aeda047f66513386eab0c970ea0f302b6227a1a7e64aef63840e9n,
	0x11c526b58d39911c310b2a808cf84fd690f713c06d4016ff30c05aded412af7an,
	0x056b338761a8093e7575ab89a9f375f59c61049079a2e5d1120dbf4adf7a9bb5n,
	0x05fc79e450ea6c00b641fdf50f5ee15c0ec5baf629ccb26d553553adf1792b00n,
	0x1168acb1e68011e4b6ff861a9f84e4ac38d250941c8536f214a0ce4f68bdb5a3n,
	0x06d4d245e2259b3166774189238cfc1b4ae5defd98f62899f0d846d20a005b91n,
	0x123313cced613293c40586b110f8e4244cd67cc4380c8f5df4ec60f42216ce28n,
	0x0acf9981fe2d6f97d7fa27873a0a368c2b19b10d15f2460a59512c4381ca0379n,
	0x011e73f99cc798e236f1fb1f38144984fed0a2cdd836d7860099423cce8c491en,
	0x0a8d98d4f22ed367167e54617b0701e64f0f9a4b17e0808eeac420473c18bcben,
	0x0e9d4c3fe8fed7780e4b179314207924caebf54185c786400384a8679b6c7252n,
	0x11d37287b2e163e78261cdcc9e4d723b0a81099340c5cfa245eccfb9ee920142n,
	0x05b231b706fb2967b2b90bade17c758c62201b5a4e04f020cdf2af76c12422f0n,
	0x0dcfd40018b5bf7bb3397d4ce2a24130ae7d74c41e48f2a25a48132f897a5ac2n,
	0x0534aaf5c42188955008e47ba93e156c7d32406566cb85f6183bf6144d8a3ee2n,
	0x023cd78594054aa62b3292f3429491566819cb081159afef6c0d12a945aa0590n,
	0x007ca89d69ee508f26d2500ece5b01925c9728aef78493806f58a2b807c6da4dn,
	0x05192bd62077895fa33a95382ba2ea0dd65ed66281c6b7a09acc94003238df37n,
	0x0d0ead8a1699babd8e6b7e3f3811463e8cfafae1915967ad4342ca59465c4014n,
	0x11c0cabe4b1e2444d8915e6a411908faf20cf1feeb59918abde560595ebb5f4fn,
	0x0f0c1c73b3c6463138527609f33d4981b21444c39d1f00c172f51c3c9aa43574n,
	0x0861d628f74762a601963dd1823ed11b9dd2456940b41659ac02fe1232355a64n,
	0x110df129163a9336afa7b9757f15f300aeb954e92b3af524222b84096d1274fdn,
	0x04c609941ec5da50d43b8d6d7d45fdd4faa8bb69929fc3337ddfc1bee29f7b94n,
	0x07a63ade8da839446b58f5d1b7fdc9432dbe55467a2b87c1779e4ce62a59e432n,
	0x120dbf222fc5d5337f22cfe76ea5597030bc328f5ef7b927678f123be9c2a394n,
	0x0b33e4820a40248cdbc3c27d7dfab70fd4b31ee9f62b2e1e048e23f9b12d5b71n,
	0x10b998b32a4e17a795d120a590e238dead3a2761cfcc9cce00b0b5c9a8656086n,
	0x0a98ebc6e3643fb6112262f125da98c0dc9eeb5c5e652716f368cf96b8888ed3n,
	0x0006ce51116858059370af176e5d32b99b8fd443d520fe34588c6254df7514f5n,
	0x0b2dddc8994767c7d3632cc7bc089becf8ef3b65540fb4709b8cc78ba12b044bn,
	0x08837cf3399fbfff03fc2e6cbb1a3b205a5a28757c827730ccd0c2f0c90fff3bn,
	0x0c238d5f2c384a72477fbdce23d461ad73d4a20f8acb2de069ec6b034b7d8c54n,
	0x0f0e46c03bd29b0cad6857149959c77f9e4f96c6688d3c2c64e228bcc0893ba4n,
	0x0d7dbd25add9892e2ea8951086a653298f4e4261e6bcdb3d980b9a45c9f4f3a9n,
	0x1197bc33ae17572ff6c8671d7a3a52f761305ba4f3a93c582e95c9f6d21dd600n,
	0x10c0f787b87b60b08241ca6547299f3afe7d86374858661f3db021676d573566n,
	0x0d527557a2a71d92e0b0c5230b02b5db478d6abd87d24caee5e9f325efec0298n,
	0x046e586141d405df5efb10855b7ea8009fdac1732b676f90de97a3e65fab3f42n,
	0x02e91572a13a6baf97560b43b5b862aebd8b7d95c0fda9c097d823cc9ef0599en,
	0x0a12c428ae449ef925394565ac50d0adb37e9e48873cf7df892b08a7b5c02875n,
	0x053d51710289df29fdcd07b74954d10edb2a29ce26f58b0868bfa608b976d162n,
	0x107983a1ea61c3c634124a87ab1271bc68dbbf1f455033dba37f441e942da248n,
	0x02f05b8c3d5883d63ad8e0fb9d5dfd79fed0a7476208a11ca79905cf50a8627an,
	0x0728f029842765bb9a7b662cc646a328bea710b0def51f6c6a0d8e3ee9286a2fn,
	0x07aee6d598f4aed60276e302085feae4608f4b249347f581ea9e246aa7b2bd2dn,
	0x0973293a99aab1398c81147a84d50bfa6aa95c659b7a4a2c153f21a13294caa6n,
	0x0f56f597f2a94ff70aed4abd9b14a863808ecffcd706f566a9065b6bf515cba5n,
	0x08d6e679d99527436d1b27315b5933cf75aaad990d3a2969032bc5595f72ed37n,
	0x0ecf9edc13aa60341dde23bdadf7a719337256129297b85719cd06d173e54320n,
	0x0f647c810044463684d83b28b6a17aef6a71db48f9af54c58c9919ded4974d2en,
	0x0f63f31b9849bcdbf503fd3b51ab77ca37a73a892a2eb5f9328fd4f2e234d20an,
];

function pow2(x: bigint): bigint {
	return (x * x) % FIELD;
}

export function mimcHash(v: bigint[]): bigint {
	let h = 0n;
	for (const x of v) {
		let y = x;
		for (const c of ROUND_CONSTANTS) {
			const temp = (y + h + c) % FIELD;
			y = pow2(pow2(pow2(pow2(temp)))) * temp;
		}
		h += x + y + h;
	}
	return h % FIELD;
}
